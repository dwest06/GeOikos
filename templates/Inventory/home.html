{% extends "base.html" %}
{% load tags %}

{% block page-title %}
Bienvenido al Sistema de Prestamo del GEO 
{% endblock  %}

{% block content %}
<div class="row mb-20">
  <!-- INFORMACION PERSONAL -->
  <div class="col-md-6 col-sm-12 mb-20">
    <div class="card text-center">
      <div class="card-header">
        <h3>Informacion Personal</h3>
      </div>
      <div class="form-group"> 
        <div class="card-body">
          <h5 class="card-title">Nombre de Usuario: {{request.user.username}}</h5>
          <p class="card-text">Email: {{request.user.email}}</p>
          <p class="card-text">Nombre: 
            {% if request.user.first_name %}
              {{request.user.first_name}}
            {% else %}
              <span class="text-danger">No Completado!</span>
            {% endif %}</p>
          <p class="card-text">Apellido: 
            {% if request.user.last_name %}
              {{request.user.last_name}}
            {% else %}
              <span class="text-danger">No Completado!</span>
            {% endif %}
          </p>
        </div>
        <p class="card-text">Estado en el sistema: {{grupo|clean}}</p>
        <p class="card-text">Estado en la agrupación: {{request.user.status|get_status}}</p>
        <a href="{% url 'Users:modify_user' user.pk %}" class="btn btn-primary">Modificar Usuario</a>
      </div>
    </div>
  </div>
  <!-- FOTO DE PERFIL -->
  <div class="col-md-6 col-sm-12 mb-20">
    <img alt="" style="border-width: 5px !important;" 
    class="img-fluid mx-auto d-block border border-dark rounded-circle " 
    src="data:image/png;base64,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">
  </div>
</div>

<div class="row">
  <!-- HISTORIAL DE SOLICITUDES-->
  <div class="col-md-12">
    <div class="card">
      <div class="card-header text-center">
        <h3>Resumen de Solicitudes</h3>
      </div>
      <div class="card-body" style="overflow-x: scroll">
        <table class="table table-hover w-full tabledat" id="solicitudes-table">
          <caption>Tabla de resumen de solicitudes</caption>
          <thead>
            <tr>
              <th class="text-center" scope="col">Id</th>
              <th class="text-center" scope="col">Fecha</th>
              <th class="text-center" scope="col">Detalles</th>
              <th class="text-center" scope="col">Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for t in solicitudes %}
            <tr>
              <td class="text-center">{{t.pk}}</td>
              <td class="text-center">{{t.date}}</td>
              <td class="text-center"><a href="{% url 'Inventory:show_request' t.pk %}" class="btn btn-info">Ver detalles</a></td>
              {% if t.user2 == None %}
              <td class="text-center text-secondary" style="font-weight:bold">Sin responder</td>
              {% elif t.status %}
              <td class="text-center text-success" style="font-weight:bold">Aprobado por {{ t.user2 }}</td>
              {% else %}
              <td class="text-center text-danger" style="font-weight:bold">Rechazado por {{ t.user2 }}</td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- HISTORIAL DE PRESTAMOS -->
  <div class="col-md-12">
    <div class="card">
      <div class="card-header text-center">
        <h3>Resumen de Prestamos</h3>
      </div>
      <div class="card-body" style="overflow-x: scroll">
        <table class="table table-hover w-full tabledat" id="prestamos-table">
          <caption>Tabla de resumen de prestamos</caption>
          <thead>
            <tr>
              <th class="text-center" scope="col">Id</th>
              <th class="text-center" scope="col">Equipo</th>
              <th class="text-center" scope="col">Fecha de recepción</th>
              <th class="text-center" scope="col">Fecha de entrega</th>
              <th class="text-center" scope="col">Fecha de devolución</th>
              <th class="text-center" scope="col">Detalles</th>
            </tr>
          </thead>
          <tbody>
            {% for t in prestamos %}
            <tr>
              <td class="text-center">{{t.pk}}</td>
              <td class="text-center">{{t.equipment.name}}</td>
              <td class="text-center">{{t.hand_over_date}}</td>
              {% if t.deadline is None %}
              <td class="text-center"><span class="text-primary" style="font-weight:bold">No se ha asignado una fecha de entrega</span></td>
              {% else %}
              <td class="text-center">{{t.deadline}}</td>
              {% endif %}
              {% if t.delivery_date is None %}
              <td class="text-center"><span class="text-success" style="font-weight:bold">Prestamo activo</span></td>
              {% else %}
              <td class="text-center">{{t.delivery_date}}</td>
              {% endif %}
              <div class="modal fade" id="info{{forloop.counter}}" tabindex="-1">
                  <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title" id="Title">Prestamo {{t.pk}}</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                              </button>
                          </div>
                          <div class="modal-body ">
                              <div class="card">
                                  <ul class="list-group list-group-flush">
                                      <li class="list-group-item text-center">
                                        <span style="font-weight:bold">Recibe: {{t.user}}</span>
                                      </li>
                                      <li class="list-group-item text-center">
                                          <span style="font-weight:bold">Entrega: {{t.creator}}</span>
                                      </li>
                                      <li class="list-group-item text-center">
                                          <span style="font-weight:bold"> Equipo: {{t.equipment.name}}</span>
                                      </li>
                                      {% if t.delivery_date is not None %}
                                        <li class="list-group-item text-center">
                                            <span style="font-weight:bold">Puntuaci贸n: {{t.score}}/5</span>
                                        </li>
                                        {% if t.notes %}
                                        <li class="list-group-item text-center">
                                            <label>Notas:</label>
                                              {{t.notes}}
                                        </li>
                                        {% endif %}
                                      {% endif %}
                                  </ul>
                              </div>
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-primary" data-dismiss="modal">Volver</button>
                          </div>
                      </div>
                  </div>
              </div>
              <td class="text-center">
                  <button class="btn btn-primary" data-toggle="modal" data-target="#info{{forloop.counter}}">
                      Ver
                  </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- DEUDAS --> 
  <div class="col-md-12 mb-20">
    <div class="card text-center">
      <div class="card-header">
        <h4>Deudas</h4>
      </div>
        <div class="card-body">
        <h5 class="card-text" style="font-weight:bold">Deuda Total: {{deuda}}</h5>
        <table class="table table-hover w-full tabledat" id="tr-table">
            <caption>Tabla de resumen de transacciones</caption>
            <thead>
              <tr>
                <th class="text-center" scope="col">Id</th>
                <th class="text-center" scope="col">Valor</th>
                <th class="text-center" scope="col">Tipo</th>
                <th class="text-center" scope="col">Fecha</th>
              </tr>
            </thead>
            <tbody>
              {% for t in trans %}
              <tr>
                <td class="text-center">{{t.pk}}</td>
                <td class="text-center">{[t.transaction}}</td>
                <td class="text-center">{{t.reason|getReason}}</td>
                <td class="text-center">{{t.date}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    </div>
  </div>
</div>
{% endblock  %}

{% block custom_js %}
<script>
  $('#solicitudes-table').DataTable({
			"order" : [[1,"desc"]],
      "language": {
        "search": "Buscar:",
        "emptyTable":     "No hay entradas para esta tabla",
        "info":           "Mostrando _START_ hasta _END_ de _TOTAL_ entradas",
        "infoEmpty":      "Mostrando 0 de 0 entradas",
        "lengthMenu":     "Mostrar _MENU_ entradas",
        "paginate": {
          "first":      "Primera",
          "last":       "Ultima",
          "next":       "Siguiente",
          "previous":   "Anterior"
        },
      }
		});
</script>
<script>
    $('#prestamos-table').DataTable({
        "order" : [[0,"desc"]],
        "language": {
          "search": "Buscar:",
          "emptyTable":     "No hay entradas para esta tabla",
          "info":           "Mostrando _START_ hasta _END_ de _TOTAL_ entradas",
          "infoEmpty":      "Mostrando 0 de 0 entradas",
          "lengthMenu":     "Mostrar _MENU_ entradas",
          "paginate": {
            "first":      "Primera",
            "last":       "Ultima",
            "next":       "Siguiente",
            "previous":   "Anterior"
          },
        }
      });
  </script>
  <script>
    $('#tr-table').DataTable({
        "order" : [[0,"desc"]],
        "language": {
          "search": "Buscar:",
          "emptyTable":     "No hay entradas para esta tabla",
          "info":           "Mostrando _START_ hasta _END_ de _TOTAL_ entradas",
          "infoEmpty":      "Mostrando 0 de 0 entradas",
          "lengthMenu":     "Mostrar _MENU_ entradas",
          "paginate": {
            "first":      "Primera",
            "last":       "Ultima",
            "next":       "Siguiente",
            "previous":   "Anterior"
          },
        }
      });
  </script>
{% endblock  %}